// <auto-generated/>
#pragma warning disable 1591
#pragma warning disable 0414
#pragma warning disable 0649
#pragma warning disable 0169

namespace WebStoreApp.Pages
{
    #line hidden
    using System;
    using System.Collections.Generic;
    using System.Linq;
    using System.Threading.Tasks;
    using Microsoft.AspNetCore.Components;
#nullable restore
#line 1 "C:\Users\MarkoProjovic\Source\Repos\WebStoreAPP\WebStoreApp\WebStoreApp\_Imports.razor"
using System.Net.Http;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "C:\Users\MarkoProjovic\Source\Repos\WebStoreAPP\WebStoreApp\WebStoreApp\_Imports.razor"
using Microsoft.AspNetCore.Components.Forms;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "C:\Users\MarkoProjovic\Source\Repos\WebStoreAPP\WebStoreApp\WebStoreApp\_Imports.razor"
using Microsoft.AspNetCore.Components.Routing;

#line default
#line hidden
#nullable disable
#nullable restore
#line 6 "C:\Users\MarkoProjovic\Source\Repos\WebStoreAPP\WebStoreApp\WebStoreApp\_Imports.razor"
using Microsoft.AspNetCore.Components.Web;

#line default
#line hidden
#nullable disable
#nullable restore
#line 7 "C:\Users\MarkoProjovic\Source\Repos\WebStoreAPP\WebStoreApp\WebStoreApp\_Imports.razor"
using Microsoft.JSInterop;

#line default
#line hidden
#nullable disable
#nullable restore
#line 8 "C:\Users\MarkoProjovic\Source\Repos\WebStoreAPP\WebStoreApp\WebStoreApp\_Imports.razor"
using WebStoreApp;

#line default
#line hidden
#nullable disable
#nullable restore
#line 9 "C:\Users\MarkoProjovic\Source\Repos\WebStoreAPP\WebStoreApp\WebStoreApp\_Imports.razor"
using WebStoreApp.Shared;

#line default
#line hidden
#nullable disable
#nullable restore
#line 10 "C:\Users\MarkoProjovic\Source\Repos\WebStoreAPP\WebStoreApp\WebStoreApp\_Imports.razor"
using WebStoreApp.Data.ApiCallService;

#line default
#line hidden
#nullable disable
#nullable restore
#line 11 "C:\Users\MarkoProjovic\Source\Repos\WebStoreAPP\WebStoreApp\WebStoreApp\_Imports.razor"
using WebStoreApp.Model;

#line default
#line hidden
#nullable disable
#nullable restore
#line 12 "C:\Users\MarkoProjovic\Source\Repos\WebStoreAPP\WebStoreApp\WebStoreApp\_Imports.razor"
using MatBlazor;

#line default
#line hidden
#nullable disable
#nullable restore
#line 13 "C:\Users\MarkoProjovic\Source\Repos\WebStoreAPP\WebStoreApp\WebStoreApp\_Imports.razor"
using WebStoreApp.Models;

#line default
#line hidden
#nullable disable
#nullable restore
#line 14 "C:\Users\MarkoProjovic\Source\Repos\WebStoreAPP\WebStoreApp\WebStoreApp\_Imports.razor"
using EmbeddedBlazorContent;

#line default
#line hidden
#nullable disable
#nullable restore
#line 15 "C:\Users\MarkoProjovic\Source\Repos\WebStoreAPP\WebStoreApp\WebStoreApp\_Imports.razor"
using WebStoreApp.Model.Account;

#line default
#line hidden
#nullable disable
#nullable restore
#line 16 "C:\Users\MarkoProjovic\Source\Repos\WebStoreAPP\WebStoreApp\WebStoreApp\_Imports.razor"
using Blazored.LocalStorage;

#line default
#line hidden
#nullable disable
#nullable restore
#line 17 "C:\Users\MarkoProjovic\Source\Repos\WebStoreAPP\WebStoreApp\WebStoreApp\_Imports.razor"
using Microsoft.AspNetCore.Components.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 18 "C:\Users\MarkoProjovic\Source\Repos\WebStoreAPP\WebStoreApp\WebStoreApp\_Imports.razor"
using Microsoft.AspNetCore.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 19 "C:\Users\MarkoProjovic\Source\Repos\WebStoreAPP\WebStoreApp\WebStoreApp\_Imports.razor"
using Radzen.Blazor;

#line default
#line hidden
#nullable disable
    [Microsoft.AspNetCore.Components.RouteAttribute("/products")]
    public partial class Products : Microsoft.AspNetCore.Components.ComponentBase
    {
        #pragma warning disable 1998
        protected override void BuildRenderTree(Microsoft.AspNetCore.Components.Rendering.RenderTreeBuilder __builder)
        {
        }
        #pragma warning restore 1998
#nullable restore
#line 147 "C:\Users\MarkoProjovic\Source\Repos\WebStoreAPP\WebStoreApp\WebStoreApp\Pages\Products.razor"
       

    ProductForCreationDto productForCreation { get; set; }

    Product product { get; set; }
    public bool Result { get; set; }
    public string RecordName { get; set; }
    //public string[] Products { get; set; }
    public bool IsGridViewFiltered { get; set; }
    bool isLoading = true;
    public string SelectedBrand { get; set; }


    protected List<string> SelectedIdsCategory = new List<string>();
    public static List<Category> Categories { get; set; }

    protected List<string> SelectedIdsSizeType = new List<string>();

    public static List<SizeType> SizeTypes { get; set; }


    public bool IsVisible { get; set; }

    List<Product> productsList { get; set; }


    ElementReference firstNameTextBox;

    protected override async Task OnInitializedAsync()
    {
        product = new Product();

        productForCreation = new ProductForCreationDto();



    }


    protected string convertImageToDisplay(string image)
    {

        if (image != null)
        {
            var fs = string.Format("data:image/jpg;base64,{0}", image);
            return fs;
        }
        return "";
    }


    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        await LoadProducts();

        SizeTypes = await SizeTypeCallService.GetAllAsList("products/sizetypes");
        Categories = await CategoryCallService.GetAllAsList("products/categories");


        StateHasChanged();

    }



    private async Task SaveProduct()
    {
        var productToSave = new ProductForCreationDto();

        productToSave.BrandTypeEID = SelectedBrand;

        productToSave.Price = product.Price;

        productToSave.Caption = product.Caption;

        productToSave.Description = product.Description;


        var categoriesForUpdate = new List<CategoryForUpdateDto>();

        SelectedIdsCategory.ForEach(x => categoriesForUpdate.Add(new CategoryForUpdateDto(Convert.ToInt32(x))));

        productToSave.listOfCategories = categoriesForUpdate;



        var sizeTypesForUpdate = new List<SizeTypeForUpdateDto>();

        SelectedIdsSizeType.ForEach(x => sizeTypesForUpdate.Add(new SizeTypeForUpdateDto(Convert.ToInt32(x))));

        productToSave.listOfSizeTypes = sizeTypesForUpdate;


        productToSave.listOfPictures = imageDataUrls.ToList();


        if (product.ProductID == 0)
            await apiCreateProductService.SaveAsync("products", productToSave);
        else
            await apiCallService.UpdateAsync("products/", product.ProductID, product);

        await LoadProducts();

        Result = true;
        IsVisible = true;

        var caption = product.Caption;


        RecordName = caption;

        product = new Product();

        //await JSRuntime.InvokeVoidAsync("saveMessage", firstName, lastName);
        await JSRuntime.InvokeVoidAsync("setFocusOnElement", firstNameTextBox);
    }


    private async Task LoadProducts()
    {
        await Task.Delay(500);

        productsList = await apiCallService.GetAllAsList("products");

    }



    private void OnSelectBrandChange(ChangeEventArgs changeEventArgs)
    {
        SelectedBrand = (string)changeEventArgs.Value;
    }



    private IList<PictureForCreationDto> imageDataUrls = new List<PictureForCreationDto>();

    private async Task OnInputFileChange(InputFileChangeEventArgs e)
    {
        var maxAllowedFiles = 3;
        var format = "image/png";

        foreach (var imageFile in e.GetMultipleFiles(maxAllowedFiles))
        {
            var resizedImageFile = await imageFile.RequestImageFileAsync(format,
                100, 100);
            var buffer = new byte[resizedImageFile.Size];
            await resizedImageFile.OpenReadStream().ReadAsync(buffer);
            var imageDataUrl = Convert.ToBase64String(buffer);     // $"data:{format};base64,{Convert.ToBase64String(buffer)}";
            var picture = new PictureForCreationDto(imageFile.Name, imageDataUrl);
            imageDataUrls.Add(picture);
        }
    }


    private async Task DeleteProduct(int authorId)
    {

        await apiCallService.DeleteAsync("products/", authorId);

        await LoadProducts();

    }

    private void EditProduct(Product p)
    {

        NavManager.NavigateTo("/editproduct/" + p.ProductID);
    }





#line default
#line hidden
#nullable disable
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private IApiCallService<SizeType> SizeTypeCallService { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private IApiCallService<Category> CategoryCallService { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private NavigationManager NavManager { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private IJSRuntime JSRuntime { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private IApiCallService<ProductForCreationDto> apiCreateProductService { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private IApiCallService<Product> apiCallService { get; set; }
    }
}
#pragma warning restore 1591
